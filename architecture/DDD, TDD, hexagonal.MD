지금 까지 작성했던 코드들은 express, nestjs 같은 프레임워크에서 제공해준 인터페이스를 사용하거나, mvc패턴을 이용해 아키텍쳐를 구성했다.
(물론 mvc 패턴이 잘못된것도 아니고, 프레임워크의 인터페이스가 나쁜것은 아니다.)
다만 전통적인 아키택쳐 패턴에는 한계가 존재한다. OOP라는 것을 이용하면서도 완벽한 OOP를 실천하지 못하고 있다.

DDD그러니까 도메인 주도 개발, hexagonal 아키택쳐(필자는 Architecture Patterns with Python을 참고했다) 이는 객체지향이 추구하는 캡슐화와 의존성 분리를 실현하기에 가장 가까운 방법이라고 생각한다.
도메인을 통해 핵심적인 비즈니스 로직을 분리하며, 모든 아키텍쳐는 도메인으로 부터 뻗어나와, 전체를 구성한다.
여기서 가장 중요한 점은 도메인은 어떤 것에도 의존해서는 안되며, 도메인의 다음 layer들은 도메인에 의존한다.

도메인은 entity와 값객체, 도메인함수의 상관관계로 이루어진다.
entity는 id를 가지고 구분되며, 메소드를 가질 수 있다.
값객체는 property자체로 구분 되며, 같은 property를 가지고 있다면, 같은 객체로 볼 수 있다. 값객체는 불변객체로 만들어지곤한다.
(함수형에서는 모든 객체가 불변객체이므로, entity또한 불변객체로 사용된다고 한다.)

여담으로, 함수형에서 이야기하는 순수함수는 도메인함수와 같다고 생각한다. 어떠한 의존성도 없고, 부수효과를 발생시키지 않는다. 도메인 함수는 비즈니스로직이 담긴 비즈니스가 구현해야할 핵심이 담긴 비즈니스 그 자체이다.
그 분야의 전문가들이 정의한 도메인 언어로 이루어져야 하며, 개발자가 아니라도 조직의 비즈니스 로직을 담당하고 있는 구성원에게 설명이 가능한 형태여야 할것이다. 이를 high-level-moudle이라고 칭하기도 한다.
(파일트리를 작성할때 꼭 도메인을 한곳에 모아둘 필요는 없다. 이는 전체 서비스의 구성에 따라 달라질 것이다.)

이러한 도메인 분리는 test에 용이하다. 물론 tdd방식으로는 test코드에 맞게 비즈니스로직을 구현하기에 용이하다고 할 수 있겠다. 왜그럴까? 의존성이 없기때문이다. 순수함수는 어떠한 의존성도 없기때문에 test가 굉장히 용이하다고 할 수 있다.
비즈니스 로직은 가장 엄격하게 테스팅되어야하며, 비즈니스 로직을 순수함수로 작성해야할 목적중 하나라고 할 수 있다.
따라서 DDD,TDD는 서로를 보완해주는 좋은 협력관계라고 할 수 있을것같다.

DDD에서 가장 어려운 것은 도메인을 전체 서비스에서 분리하는것이라고 할 수 있다. 그냥 high-level-module을, 개발자가 아닌 사람들도 이해할 수 있는 로직, 의존성을 모두 걷어낸 로직을 짜면되는게 아니냐고 할 수 있다.
그러나 조직의 모든 구성원(오너, 기획자, 개발자 등)들과 합의하에 우리 조직의 핵심 비즈니스 로직을 먼저 짜야한다는점이 어렵다. 이는 개발자이기 이전에 비즈니스를 바라보고 생각해야한다는 점에서, 개발만 하고싶은 개발자라면 정말 귀찮은 일이 아닐 수 없다. 만약 다른 구성원들이 이러한 부분들을 다 설계해서 짜준다고 해도 큰산이 하나 남는다. 도메인 언어와 비즈니스 로직을 이용해 어떤 추상화된 entity들을 만들고, 이 entity들을 어떻게 연결해야할지 고민해야한다.
추상화가 완료되고, 각 entity들의 관계를 설정했다면, 테스트 코드를 짜면된다!